<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="riskassessment">
<title>Deployment V0.1.1 • riskassessment</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Deployment V0.1.1">
<meta property="og:description" content="riskassessment">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">riskassessment</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/riskassessment.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>User Guides</h6>
    <a class="dropdown-item" href="../articles/Credential_Manager.html">Credential Manager</a>
    <a class="dropdown-item" href="../articles/User_Roles_and_Privileges.html">User Roles and Privileges</a>
    <a class="dropdown-item" href="../articles/Deployment.html">Deployment</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pharmaR/riskassessment/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Deployment V0.1.1</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pharmaR/riskassessment/blob/HEAD/vignettes/Deployment_V0.1.1.Rmd" class="external-link"><code>vignettes/Deployment_V0.1.1.Rmd</code></a></small>
      <div class="d-none name"><code>Deployment_V0.1.1.Rmd</code></div>
    </div>

    
    
<p>To reap all the advantages of the <code>riskassessment</code>
application, an organization needs to generate and store results
frequently derived from the app, including but not limited to:</p>
<p><img src="images/deploy_rocket.png" style="float:right; height:140px"></p>
<ol style="list-style-type: decimal">
<li>Uploading new packages, &amp; storing their metric info and
<code>riskmetric</code> score</li>
<li>Publishing reviewer comments</li>
<li>Submitting package decisions</li>
<li>Storing organization-wide metric weights and score-based thresholds
for decision automation</li>
<li>Credential management for authorized users</li>
<li>Etc</li>
</ol>
<p>To accomplish this, the app automatically creates and populates
several storage solutions locally, in the app’s root directory:</p>
<ul>
<li>A <code>SQLite</code> database named <code>credentials.sqlite</code>
(by default) for credential management</li>
<li>A <code>loggit.json</code>, recording rudimentary logs of actions
performed in the app</li>
<li>A <code>SQLite</code> database named <code>database.sqlite</code>
(by default) for storing all pkg info, metric info, and comments/
decisions</li>
<li>A <code>auto_decisions.json</code> file, that initiates and keeps
track of score-based thresholds for decision automation</li>
</ul>
<p>Note that this article won’t cover the credentials database since
that’s that’s been covered (at length) in the <a href="../articles/Administrative_Tools_and_Options_V0.1.1.html">“Administrative
Tools and Options” guide</a>. As you might expect, some deployment
environments come with limitations that are not amicable to storage
method defined above! Spoiler alert - shinyapps.io is one of them. This
article will provide more details about these crucial storage objects
and share a run down of the following deployment options with helpful
tips:</p>
<ul>
<li><p>shinyapps.io</p></li>
<li><p>RStudio Connect</p></li>
<li><p>Shiny Server</p></li>
<li><p>ShinyProxy</p></li>
</ul>
<p>Note! In the future, we’ll consider adding utilities that would allow
users to connect to an external, or remote storage method (like a
database).</p>
<p><br></p>
<div class="section level2">
<h2 id="the-database-sqlite-file">The <code>database.sqlite</code> file<a class="anchor" aria-label="anchor" href="#the-database-sqlite-file"></a>
</h2>
<p><img src="images/SQLite.png" style="float:right; height:80px"></p>
<p>When the <code><a href="../reference/run_app.html">riskassessment::run_app()</a></code> function is ran, the
code base will check if the <code>database.sqlite</code> file exists,
and if it doesn’t, <a href="https://github.com/pharmaR/riskassessment/tree/master/inst/app/www/sql_queries" class="external-link">several
tables will be initiated</a> to create this database just before the app
launches. Note that the user has the authority to name the database file
to whatever they like using the <code>assessment_db_name</code> argument
in <code><a href="../reference/run_app.html">run_app()</a></code>. In addition, you can include a file path here
preceding the file name if you wish to move the location of the database
away from the root directory. For example, the following code would
create a database called “test_database.sqlite” in the <code>dev/</code>
folder:</p>
<pre><code><span><span class="fu"><a href="../reference/run_app.html">run_app</a></span><span class="op">(</span>assessment_db_name <span class="op">=</span> <span class="st">'./dev/test_database.sqlite'</span><span class="op">)</span></span></code></pre>
<p>At the time this vignette was authored, the database will initialize
the following tables with all <code>NULL</code> values:</p>
<ul>
<li>
<code>comments</code>: stores user comments, including user names
associated with each comment entry, comment type, and timestamp</li>
<li>
<code>community_usage_metrics</code>: stores CRAN package downloads
per month</li>
<li>
<code>metric</code>: stores metric info, including the
<code>riskmetric</code> name, label, short description, type, and
weight</li>
<li>
<code>package_metrics</code>: stores all package-specific
<code>rismetric</code> metrics</li>
<li>
<code>package</code>: Contains all package information, like name,
version, maintainer, etc. It also contains a the <code>riskmetric</code>
score, the weighted score, decision, and timestamp.</li>
</ul>
<p>There is one exception to this: the <code>metric</code> table is
populated with data via the <a href="https://github.com/pharmaR/riskassessment/blob/master/inst/app/www/sql_queries/initialize_metric_table.sql" class="external-link">initialize_metric_table.sql</a>
file. If the user deploying the app wants to enter certain weights prior
to launching the application, this would be a good place to do it. For
example, if your org wants to place a heavier weight on “has_vignettes”,
then you can increase the <code>weight</code> value up accordingly. Of
course, you can still do this in the application, but that would require
a manual change once the app has launched. Similarly, if you want to
ignore a certain metric because it has little value to our organization,
you could give it a value of zero here.</p>
<p>Note: if any changes/ updates occur in these tables with a new
release of <code>riskassessment</code>, you may need to delete the
database file before re-running the app. Any such changes should be
announced as ‘breaking changes’ in the app. If so, remember to save a
copy of your current database file in another directory for backup
purposes.</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="the-loggit-json-file">The <code>loggit.json</code> file<a class="anchor" aria-label="anchor" href="#the-loggit-json-file"></a>
</h2>
<p>As mentioned previously, the <code>loggit.json</code> file is
initiated to track general actions performed in the application,
especially those that would impact a change in the
<code>database.sqlite</code> file. At the time this vignette was
authored, here’s a summary of actions logged:</p>
<ul>
<li>App start up</li>
<li>User log-ins</li>
<li>Enabling/ Disabling or changing automated decision rules</li>
<li>Decisions initiated by users or the decision automation rules,
including</li>
<li>When pkgs are added or removed from the database, or when there are
issues with this process, like when there is an absence of data to that
support certain metrics</li>
<li>Re-weighting pkg metrics</li>
<li>Any database issues or conflicts that may arise</li>
</ul>
<p>Each loggit “transaction” recorded contains a lot of info, but most
notably, it will contain a timestamp, record type (“info”, “warn”, or
“error”), and a message. For database transactions, the message will
usually include the query that was executed. All log entries are always
printed out in the R console for your convenience. For example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>riskassessment<span class="sc">::</span><span class="fu">run_app</span>()</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="sc">&gt;</span> [<span class="dv">1</span>] <span class="st">"Log file set to loggit.json"</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="sc">&gt;</span> Listening on http<span class="sc">:</span><span class="er">//</span><span class="dv">127</span>.<span class="dv">0</span>.<span class="fl">0.1</span><span class="sc">:</span><span class="dv">4097</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="sc">&gt;</span> {<span class="st">"timestamp"</span><span class="sc">:</span> <span class="st">"2023-03-20T11:46:23-0400"</span>, <span class="st">"log_lvl"</span><span class="sc">:</span> <span class="st">"INFO"</span>, <span class="st">"log_msg"</span><span class="sc">:</span> <span class="st">"User admin signed on as admin"</span>}</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="sc">&gt;</span> {<span class="st">"timestamp"</span><span class="sc">:</span> <span class="st">"2023-03-20T11:46:33-0400"</span>, <span class="st">"log_lvl"</span><span class="sc">:</span> <span class="st">"INFO"</span>, <span class="st">"log_msg"</span><span class="sc">:</span> <span class="st">"The following decision rules were implemented by admin (admin): Medium = (0.33__COMMA__ 0.66]; Low = (0__COMMA__ 0.33]; High = (0.66__COMMA__ 1]."</span>}</span></code></pre></div>
<p>Feel free to use this information as you see fit!</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="the-auto_decisions-json-file">The <code>auto_decisions.json</code> file<a class="anchor" aria-label="anchor" href="#the-auto_decisions-json-file"></a>
</h2>
<p>When <code><a href="../reference/run_app.html">riskassessment::run_app()</a></code> is executed, a search is
performed to see if there exists an <code>auto_decisions.json</code>
file in the root directory. Without such file, an empty one will be
automatically created. This file is used to keep track of any decision
automation rules. As you add &amp; edit the rules in the app, the
<code>json</code> file will update accordingly, keeping track of each
categories risk score range. For example, the following json file
coordinates with ranges displayed in the app:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">{</span><span class="dt">"Medium"</span><span class="fu">:</span><span class="ot">[</span><span class="dv">0</span><span class="er">.</span><span class="dv">33</span><span class="ot">,</span><span class="dv">0</span><span class="er">.</span><span class="dv">66</span><span class="ot">]</span><span class="fu">,</span><span class="dt">"Low"</span><span class="fu">:</span><span class="ot">[</span><span class="dv">0</span><span class="ot">,</span><span class="dv">0</span><span class="er">.</span><span class="dv">33</span><span class="ot">]</span><span class="fu">,</span><span class="dt">"High"</span><span class="fu">:</span><span class="ot">[</span><span class="dv">0</span><span class="er">.</span><span class="dv">66</span><span class="ot">,</span><span class="dv">1</span><span class="ot">]</span><span class="fu">}</span></span></code></pre></div>
<center>
<img src="images/deploy_full_auto_decision_rules.png" style="position:left; width:456px">
</center>
<p><br></p>
</div>
<div class="section level2">
<h2 id="deployment-options">Deployment options<a class="anchor" aria-label="anchor" href="#deployment-options"></a>
</h2>
<center>
<img src="images/deploy_general.png" style="height:220px">
</center>
<div class="section level3">
<h3 id="shinyapps-io">shinyapps.io<a class="anchor" aria-label="anchor" href="#shinyapps-io"></a>
</h3>
<p>Beware: shinyapps.io <strong>does not</strong> offer persistent
storage of <code>riskassessment</code>’s <code>SQLite</code> database or
logs. Thus, it <strong>is not</strong> likely a viable deployment option
for your organization or group. For example, our <a href="https://rinpharma.shinyapps.io/riskassessment" class="external-link">demo
application</a> (hosted on shinyapps.io) contains a pre-prepared
database of packages that can’t be permanently altered. It CAN be
altered within a session, but any changes <strong>will not</strong>
persist outside the session.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="posit-connect-shiny-server">Posit Connect &amp; Shiny Server<a class="anchor" aria-label="anchor" href="#posit-connect-shiny-server"></a>
</h3>
<p><img src="images/deploy_posit_rsconnect_logo.png" style="float:right; height:160px"></p>
<p><br></p>
<p>On a server, if you want to save files on disk, you’ll need to set
write permissions accordingly on the folder you want to save the
database, logs, and auto-decision json file.</p>
<p>On Posit Connect, you need to use an absolute path to specify the
directory where to save the files. You can find more information here:
<a href="https://support.rstudio.com/hc/en-us/articles/360007981134-Persistent-Storage-on-RStudio-Connect" class="external-link">Persistent
Storage on Posit Connect</a>.</p>
<p><br></p>
<p>Beyond that, it’s important to note that we strongly encourage those
deploying the app to take advantage of the <code>renv.lock</code> file
used to maintain package version dependencies. For more information on
how to use <code>renv.lock</code> and our general dev philosophy as it
pertains to package management, please read the <a href="https://pharmar.github.io/riskassessment/articles/dev_renv.html">“Using
<code>renv</code>”</a> article. Highly related, we encourage the use of
git-backed deployment when possible. So, immediately after you
update/sync your package dependencies using <code>renv</code>, you may
want to run <code>rsconnect::writeManifest()</code> before deploying
from a dedicated branch. For more information on git-backed deployment
&amp; manifest files, please read the Posit article on <a href="https://docs.posit.co/connect/user/git-backed/" class="external-link">git-backed
content</a>.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="shinyproxy">ShinyProxy<a class="anchor" aria-label="anchor" href="#shinyproxy"></a>
</h3>
<p><img src="images/deploy_shinyproxy.png" style="float:right; height:160px"></p>
<p>With <a href="https://www.shinyproxy.io/" class="external-link">ShinyProxy</a>, you can use
a Docker volume to write files outside of the application container. In
<code>application.yml</code>, you use can something like this in the
specs describing the application:</p>
<blockquote>
<p>container-volumes: [ “/var/log/shinylogs:/root/logs” ]</p>
</blockquote>
<p><code>/var/log/shinylogs</code> is a directory on the server where
you deploy your applications with ShinyProxy. <code>/root/logs</code> is
a directory inside your Docker image.</p>
<p><br></p>
<p><br></p>
<p><br></p>
<p><br></p>
<p><br></p>
<p><br></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Aaron Clark, Jeff Thompson, Robert Krajcik, Lars Andersen, Andrew Borgman, Marly Gotti, Maya Gans, Aravind Reddy Kallem, Fission Labs India Pvt Ltd, PSI special interest group Application and Implementation of Methodologies in Statistics, R Validation Hub.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
